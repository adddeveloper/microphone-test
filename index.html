<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Standard favicon -->
    <link rel="icon" type="image/x-icon" href="favicon/favicon.ico">

    <!-- PNG favicons -->
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="favicon/favicon-48x48.png">
    <link rel="icon" type="image/png" sizes="64x64" href="favicon/favicon-64x64.png">

    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">

    <!-- Web App Manifest -->
    <link rel="manifest" href="favicon/site.webmanifest">
    <title>Camera Test</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üì∑ Camera Test</h1>
            <p>Check if your webcam is connected and working properly</p>
        </header>
        
        <div class="test-instructions">
            <p>Click the start button to begin testing your camera. Make sure to allow camera access when prompted.</p>
        </div>
        
        <div class="test-area">
            <button id="startButton" class="test-button">
                <span>‚ñ∂</span>
                Start Camera
            </button>
            
            <button id="stopButton" class="test-button" disabled>
                <span>‚èπ</span>
                Stop Camera
            </button>
            
            <button id="captureButton" class="test-button" disabled>
                <span>üì∏</span>
                Capture Photo
            </button>
        </div>
        
        <div class="camera-preview">
            <video id="videoPreview" autoplay playsinline></video>
            <canvas id="photoCanvas" style="display: none;"></canvas>
        </div>
        
        <div class="status" id="statusMessage">
            Ready to test camera...
        </div>
        
        <div class="photo-preview" id="photoPreviewContainer" style="display: none;">
            <h3>Captured Photo</h3>
            <img id="photoPreview" alt="Captured photo">
            <button id="downloadButton" class="test-button">
                <span>üì•</span>
                Download Photo
            </button>
        </div>
        
        <div class="checklist">
            <div>
                <h2>What to do if you can't see video</h2>
                <p>Make sure that your camera is properly connected to your computer.</p>
                <p>Check that your browser has permission to access your camera.</p>
                <p>Ensure no other application is using your camera.</p>
                <p>Check that the correct camera is selected in your browser settings.</p>
            </div>
            
            <div>
                <h2>Camera access denied?</h2>
                <p>Check your browser's permission settings for camera access.</p>
                <p>Make sure your browser is updated to the latest version.</p>
            </div>
            
            <div>
                <h2>All tests failed?</h2>
                <p>If you tried all the advice on this page and nothing worked, the problem might be with your camera drivers. Try to search for the latest drivers for your camera model.</p>
                <p>Try testing your camera with another application to verify if it's working.</p>
            </div>
        </div>
        
        <footer>
            <p>Use this camera test to quickly check your webcam without leaving the browser.</p>
        </footer>
    </div>

    <script>
        // DOM elements
        const startButton = document.getElementById('startButton');
        const stopButton = document.getElementById('stopButton');
        const captureButton = document.getElementById('captureButton');
        const downloadButton = document.getElementById('downloadButton');
        const statusMessage = document.getElementById('statusMessage');
        const videoPreview = document.getElementById('videoPreview');
        const photoCanvas = document.getElementById('photoCanvas');
        const photoPreview = document.getElementById('photoPreview');
        const photoPreviewContainer = document.getElementById('photoPreviewContainer');
        
        // Camera variables
        let mediaStream = null;
        let capturedPhotoUrl = null;
        
        // Initialize the application
        async function init() {
            // Check if browser supports media devices
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                statusMessage.textContent = "Your browser doesn't support camera access.";
                startButton.disabled = true;
                return;
            }
            
            statusMessage.textContent = "Ready to test camera. Click start to begin.";
        }
        
        // Start camera
        async function startCamera() {
            try {
                statusMessage.textContent = "Accessing camera...";
                
                // Request camera access
                mediaStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        width: { ideal: 1280 },
                        height: { ideal: 720 } 
                    }, 
                    audio: false 
                });
                
                // Show video stream
                videoPreview.srcObject = mediaStream;
                
                // Enable buttons
                stopButton.disabled = false;
                captureButton.disabled = false;
                startButton.disabled = true;
                
                statusMessage.textContent = "Camera is active. You should see yourself above.";
                
            } catch (error) {
                console.error("Error accessing camera:", error);
                statusMessage.textContent = "Error accessing camera: " + error.message;
            }
        }
        
        // Stop camera
        function stopCamera() {
            if (mediaStream) {
                mediaStream.getTracks().forEach(track => track.stop());
                mediaStream = null;
            }
            
            videoPreview.srcObject = null;
            
            // Reset buttons
            startButton.disabled = false;
            stopButton.disabled = true;
            captureButton.disabled = true;
            
            statusMessage.textContent = "Camera stopped. Click start to test again.";
        }
        
        // Capture photo
        function capturePhoto() {
            if (!mediaStream) return;
            
            // Set canvas dimensions to match video
            const videoWidth = videoPreview.videoWidth;
            const videoHeight = videoPreview.videoHeight;
            photoCanvas.width = videoWidth;
            photoCanvas.height = videoHeight;
            
            // Draw current video frame to canvas
            const context = photoCanvas.getContext('2d');
            context.drawImage(videoPreview, 0, 0, videoWidth, videoHeight);
            
            // Convert to data URL and display
            capturedPhotoUrl = photoCanvas.toDataURL('image/png');
            photoPreview.src = capturedPhotoUrl;
            photoPreviewContainer.style.display = 'block';
            
            statusMessage.textContent = "Photo captured!";
            
            // Scroll to photo preview
            photoPreviewContainer.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Download photo
        function downloadPhoto() {
            if (!capturedPhotoUrl) return;
            
            const downloadLink = document.createElement('a');
            downloadLink.href = capturedPhotoUrl;
            downloadLink.download = 'camera-test-photo.png';
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
            
            statusMessage.textContent = "Photo downloaded!";
        }
        
        // Event listeners
        startButton.addEventListener('click', startCamera);
        stopButton.addEventListener('click', stopCamera);
        captureButton.addEventListener('click', capturePhoto);
        downloadButton.addEventListener('click', downloadPhoto);
        
        // Initialize on load
        window.addEventListener('load', init);
    </script>
</body>
</html>