<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Standard favicon -->
    <link rel="icon" type="image/x-icon" href="favicon/favicon.ico">

    <!-- PNG favicons -->
    <link rel="icon" type="image/png" sizes="16x16" href="favicon/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="favicon/favicon-48x48.png">
    <link rel="icon" type="image/png" sizes="64x64" href="favicon/favicon-64x64.png">

    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon.png">

    <!-- Web App Manifest -->
    <link rel="manifest" href="favicon/site.webmanifest">
    <title>Microphone Test</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üé§ Microphone Test</h1>
            <p>Check if your microphone is connected and working properly</p>
        </header>
        
        <div class="test-instructions">
            <p>Click the record button, speak into your microphone, then play back to test</p>
        </div>
        
        <div class="test-area">
            <button id="recordButton" class="test-button">
                <span>‚óè</span>
                Record
            </button>
            
            <button id="playButton" class="test-button" disabled>
                Playback
                <span>‚ñ∂</span>
            </button>
        </div>
        
        <div class="visualizer">
            <canvas id="visualizerCanvas"></canvas>
        </div>
        
        <div class="status" id="statusMessage">
            Ready to record...
        </div>
        
        <div class="checklist">
            <div>
                <h2>What to do if you can't record sound</h2>
                <p>Make sure that your microphone is properly connected to your computer.</p>
                <p>Check that your browser has permission to access your microphone.</p>
                <p>Ensure your microphone isn't muted in your system settings.</p>
                <p>Check that the correct input device is selected in your operating system.</p>
            </div>
            
            <div>
                <h2>Recording but no playback?</h2>
                <p>Make sure your speakers or headphones are properly connected and not muted.</p>
                <p>Check your system's volume settings for both input and output devices.</p>
            </div>
            
            <div>
                <h2>All tests failed?</h2>
                <p>If you tried all the advice on this page and nothing worked, the problem might be with your audio drivers. Try to search for the latest drivers for your sound card.</p>
            </div>
        </div>
        
        <footer>
            <p style="padding: 0; margin:0;">Use this microphone test to quickly check your microphone without leaving the browser.</p>
            <p>‚ö†Ô∏è This website was made with the help of AI.</p>
        </footer>
    </div>

    <script>
        // DOM elements
        const recordButton = document.getElementById('recordButton');
        const playButton = document.getElementById('playButton');
        const statusMessage = document.getElementById('statusMessage');
        const canvas = document.getElementById('visualizerCanvas');
        const canvasCtx = canvas.getContext('2d');
        
        // Audio variables
        let audioRecorder;
        let audioChunks = [];
        let recordedAudio;
        let mediaStream;
        let audioContext;
        let analyser;
        let visualizationInterval;
        
        // Set up canvas
        function setupCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = 80;
        }
        
        // Initialize the application
        async function init() {
            setupCanvas();
            
            try {
                // Request microphone access
                mediaStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                statusMessage.textContent = "Microphone access granted. Click record to start.";
                
                // Set up audio context and analyser for visualization
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                const source = audioContext.createMediaStreamSource(mediaStream);
                source.connect(analyser);
                analyser.fftSize = 256;
                
                // Set up audio recorder
                audioRecorder = new MediaRecorder(mediaStream);
                
                // Event handlers for recording
                audioRecorder.ondataavailable = (event) => {
                    audioChunks.push(event.data);
                };
                
                audioRecorder.onstop = () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                    recordedAudio = URL.createObjectURL(audioBlob);
                    playButton.disabled = false;
                    statusMessage.textContent = "Recording complete. Click play to listen.";
                    stopVisualization();
                };
                
            } catch (error) {
                statusMessage.textContent = "Error accessing microphone: " + error.message;
                recordButton.disabled = true;
            }
        }
        
        // Start visualization
        function startVisualization() {
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);
            
            function draw() {
                visualizationInterval = requestAnimationFrame(draw);
                analyser.getByteFrequencyData(dataArray);
                
                canvasCtx.fillStyle = 'rgb(245, 245, 245)';
                canvasCtx.fillRect(0, 0, canvas.width, canvas.height);
                
                const barWidth = (canvas.width / bufferLength) * 2.5;
                let barHeight;
                let x = 0;
                
                for(let i = 0; i < bufferLength; i++) {
                    barHeight = dataArray[i] / 2;
                    
                    canvasCtx.fillStyle = 'rgb(' + (barHeight + 100) + ', 50, 50)';
                    canvasCtx.fillRect(x, canvas.height - barHeight, barWidth, barHeight);
                    
                    x += barWidth + 1;
                }
            }
            
            draw();
        }
        
        // Stop visualization
        function stopVisualization() {
            cancelAnimationFrame(visualizationInterval);
            canvasCtx.clearRect(0, 0, canvas.width, canvas.height);
        }
        
        // Toggle recording
        recordButton.addEventListener('click', () => {
            if (audioRecorder.state === 'recording') {
                audioRecorder.stop();
                recordButton.innerHTML = '<span>‚óè</span> Record';
                recordButton.style.backgroundColor = '';
            } else {
                audioChunks = [];
                audioRecorder.start();
                recordButton.innerHTML = '<span>‚èπ</span> Stop';
                recordButton.style.backgroundColor = 'var(--red)';
                playButton.disabled = true;
                statusMessage.textContent = "Recording... Speak into your microphone.";
                startVisualization();
            }
        });
        
        // Play recorded audio
        playButton.addEventListener('click', () => {
            if (recordedAudio) {
                const audio = new Audio(recordedAudio);
                audio.play();
                statusMessage.textContent = "Playing back recorded audio...";
                
                audio.onended = () => {
                    statusMessage.textContent = "Playback complete. Record again if needed.";
                };
            }
        });
        
        // Initialize on load
        window.addEventListener('load', init);
        window.addEventListener('resize', setupCanvas);
    </script>
</body>
</html>